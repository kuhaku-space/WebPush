<!DOCTYPE html>
<html>

<head>
  <meta charset='utf-8/'>
  <link rel="manifest" href="./manifest.json">
  <script>
    // service workerが有効なら、service-worker.js を登録します
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('./service-worker.js');
    }
  </script>
</head>

<body>
  <button id="allow_push_notification">トークン取得</button>
  <p id="output"></p>
  <script type="module">
    importScripts('https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js');
    importScripts('https://www.gstatic.com/firebasejs/11.0.1/firebase-messaging.js');

    // Your web app's Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyDn7GAZJL3717JCLyB4bam01Yo5EE0jPhQ",
      authDomain: "webpush-e9c3d.firebaseapp.com",
      projectId: "webpush-e9c3d",
      storageBucket: "webpush-e9c3d.appspot.com",
      messagingSenderId: "740768659038",
      appId: "1:740768659038:web:f2b480c750b8e98035e6cf",
      measurementId: "G-T65D0NMC7V"
    };

    // Initialize Firebase
    const app = firebase.initializeApp(firebaseConfig);

    // 通知を許可するボタンが押された時のアクション
    const btn = document.getElementById('allow_push_notification');
    btn.addEventListener("click", function () {
      if (!("Notification" in window)) { // ブラウザーが通知に対応しているか調べる
        alert("このブラウザーはデスクトップ通知には対応していません。");
      } else if ("serviceWorker" in navigator) {
        navigator.serviceWorker
          .register("./firebase-messaging-sw.js")
          .then(function (registration) {
            console.log("Registration successful, scope is:", registration.scope);
            firebase.getToken({ vapidKey: 'BJ7potPULcKaMJ5s3p4GgkeQXUS-uqa-UBVtJ-a0oc2L_lcBKbTRR2Ie1JKIHUo3q_5RGQ_qizk57WjksAkpra4', serviceWorkerRegistration: registration })
              .then((currentToken) => {
                if (currentToken) {
                  console.log('current token for client: ', currentToken);
                } else {
                  console.log('No registration token available. Request permission to generate one.');
                }
              }).catch((err) => {
                console.log('An error occurred while retrieving token. ', err);
              });
          })
          .catch(function (err) {
            console.log("Service worker registration failed, error:", err);
          });
      }
    });
  </script>
</body>

</html>
